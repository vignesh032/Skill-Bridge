<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Skill Bridge - Career Roadmap">
  <title>Skill Bridge</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Import Map for Three.js -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>

  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>

  <!-- Animated background shapes (Kept as fallback or layer) -->
  <div class="bg-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
  </div>

  <!-- 3D Scene Layer -->
  <div id="canvas-container" style="display: flex; justify-content: center; align-items: center; color: #22D3EE;">
    <h2>Loading 3D Experience...</h2>
  </div>

  <!-- 3D UI Overlay Layer -->
  <div id="ui-layer">
    <div id="labels-container"></div>
    <!-- Side Panels for Navigation -->
    <div id="left-sections-panel" class="side-panel"></div>
    <div id="right-sections-panel" class="side-panel"></div>

    <button id="interact-btn">Explore</button>
    <div id="toast"></div>
    <div class="controls-hint">
      <div class="key">â†‘</div>
      <div class="row">
        <div class="key">â†</div>
        <div class="key">â†“</div>
        <div class="key">â†’</div>
      </div>
      <span>Navigate Robot</span>
    </div>
  </div>

  <!-- Intro Page Sidebar -->
  <div id="intro-sidebar" class="intro-sidebar">
    <div class="sidebar-header">
      <h2 class="logo">SkillBridge</h2>
    </div>
    <nav id="intro-nav">
      <button class="intro-nav-btn unlocked" data-section="Dashboard" onclick="window.introScene.enterSection(window.introScene.CONFIG.sections[0])">ğŸ“Š Dashboard</button>
      <button class="intro-nav-btn" data-section="Skills" onclick="window.introScene.enterSection(window.introScene.CONFIG.sections[1])">ğŸ§  Skill Analysis</button>
      <button class="intro-nav-btn" data-section="Roadmap" onclick="window.introScene.enterSection(window.introScene.CONFIG.sections[2])">ğŸ›£ï¸ Career Roadmap</button>
      <button class="intro-nav-btn" data-section="Internships" onclick="window.introScene.enterSection(window.introScene.CONFIG.sections[3])">ğŸš€ Internships & Projects</button>
      <button class="intro-nav-btn" data-section="Resume" onclick="window.introScene.enterSection(window.introScene.CONFIG.sections[4])">ğŸ“„ Resume Tracker</button>
    </nav>
  </div>

  <!-- Main App (Hidden Initially) -->
  <div class="app" style="display: none;">

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2 class="logo">SkillBridge</h2>
        <button class="close-btn" onclick="closeSidebar()">âœ–</button>
      </div>

      <nav id="sidebar-nav">
        <button class="nav-section active unlocked" data-section="Dashboard" onclick="loadContent('dashboard', this)"
          title="Get an overview of your career progress and key metrics">ğŸ“Š Dashboard</button>
        <button class="nav-section unlocked" data-section="Skills" onclick="window.location.href='skills-analysis.html'"
          title="Analyze your skills with interactive charts and industry comparisons">ğŸ§  Skill Analysis</button>
        <button class="nav-section unlocked" data-section="Roadmap" onclick="window.location.href='roadmap.html'"
          title="Explore personalized career paths with guidance and connections">ğŸ›£ï¸ Career Roadmap</button>
        <button class="nav-section unlocked" data-section="Internships" onclick="window.location.href='internships.html'"
          title="Find internships and project opportunities to build experience">ğŸš€ Internships & Projects</button>
        <button class="nav-section unlocked" data-section="Resume" onclick="window.location.href='resume.html'"
          title="Track and optimize your resume for better job prospects">ğŸ“„ Resume Tracker</button>
      </nav>
    </aside>

    <!-- Main -->
    <div class="main">
      <header class="navbar">
        <div style="display: flex; gap: 10px; align-items: center;">
          <button class="back-btn" onclick="goBack()" title="Go back">â† Back</button>
          <button class="menu-btn" onclick="openSidebar()">â˜°</button>
        </div>
        <h1 id="pageTitle">Dashboard</h1>
        <div class="profile" onclick="logout()" style="cursor: pointer;">ğŸ‘¤ Student</div>
      </header>

      <main class="content" id="content"></main>
    </div>

  </div>

  <!-- Modules -->
  <script type="module" src="intro.js"></script>

  <!-- Firebase & App Scripts -->
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
  <script>
    // Check if Firebase is available
    let firebaseAvailable = false;

    try {
      const firebaseConfig = {
        apiKey: "AIzaSyCgffF2_yiVYND2pl4j3-JJezYrI0Gzw7I",
        authDomain: "skill-bridge-92cff.firebaseapp.com",
        projectId: "skill-bridge-92cff",
        storageBucket: "skill-bridge-92cff.firebasestorage.app",
        messagingSenderId: "379886840265",
        appId: "1:379886840265:web:f73b1fc51080a2b7ace018",
        measurementId: "G-JKWNG1Y836"
      };

      firebase.initializeApp(firebaseConfig);
      window.auth = firebase.auth();
      window.db = firebase.firestore();
      const auth = firebase.auth();
      const db = firebase.firestore();
      firebaseAvailable = true;

      auth.onAuthStateChanged(async (user) => {
        if (user) {
          try {
            const userDoc = await db.collection("users").doc(user.uid).get();
            if (userDoc.exists) {
              const userData = userDoc.data();
              document.querySelector('.profile').textContent = userData.name;
            }
          } catch (error) {
            console.log("Firestore error, falling back to local storage:", error);
            loadFromLocalStorage();
          }
        } else {
          loadFromLocalStorage();
        }
      });
    } catch (error) {
      console.log("Firebase not available, using local storage fallback");
      loadFromLocalStorage();
    }

    function loadFromLocalStorage() {
      const savedProfile = localStorage.getItem('userProfile');
      if (savedProfile) {
        const userData = JSON.parse(savedProfile);
        if (userData.fullName) {
          document.querySelector('.profile').textContent = userData.fullName;
        }
      }
    }
  </script>
  <script src="roles-config.js"></script>
  <script src="script.js"></script>
  <script>
    // Fail-safe: If 3D doesn't load in 4 seconds, show the app
    setTimeout(() => {
      const loading = document.getElementById('canvas-container');
      if (loading && loading.innerText.includes('Loading')) {
        console.warn("3D Timeout - forcing app display");
        loading.style.display = 'none';
        document.querySelector('.app').style.display = 'flex';
        document.getElementById('ui-layer').style.display = 'none';
      }
    }, 4000);
  </script>
</body>

</html>