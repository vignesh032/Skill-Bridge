<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SkillBridge - Resume Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="app">

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2 class="logo">SkillBridge</h2>
      <button class="close-btn" onclick="closeSidebar()">‚úñ</button>
    </div>

    <nav>
      <button onclick="window.location.href='index.html'" title="Get an overview of your career progress and key metrics">üìä Dashboard</button>
      <button onclick="window.location.href='skills-analysis.html'" title="Analyze your skills with interactive charts and industry comparisons">üß† Skill Analysis</button>
      <button onclick="window.location.href='roadmap.html'" title="Explore personalized career paths with guidance and connections">üõ£Ô∏è Career Roadmap</button>
      <button onclick="window.location.href='internships.html'" title="Find internships and project opportunities to build experience">üöÄ Internships & Projects</button>
      <button class="active" onclick="window.location.href='resume.html'" title="Track and optimize your resume for better job prospects">üìÑ Resume Tracker</button>
    </nav>
  </aside>

  <!-- Main -->
  <div class="main">
    <header class="navbar">
      <button class="menu-btn" onclick="openSidebar()">‚ò∞</button>
      <h1 id="pageTitle">Resume Tracker</h1>
      <div class="profile" onclick="logout()" style="cursor: pointer;">üë§ Student</div>
    </header>

    <main class="content" id="content">
      <div class="resume-builder">
        <div class="card">
          <h3>Build Your Resume</h3>
          <form id="resumeForm">
            <label>Name: <input type="text" id="resumeName" required></label><br>
            <label>Email: <input type="email" id="resumeEmail" required></label><br>
            <label>Phone: <input type="tel" id="resumePhone" required></label><br>
            <label>Education: <textarea id="resumeEducation" placeholder="e.g., B.Tech in CSE, 2020-2024"></textarea><br>
            <label>Skills: <textarea id="resumeSkills" placeholder="e.g., HTML, CSS, JavaScript"></textarea><br>
            <label>Experience: <textarea id="resumeExperience" placeholder="e.g., Intern at XYZ, 2023"></textarea><br>
            <label>Projects: <textarea id="resumeProjects" placeholder="e.g., Portfolio Website"></textarea><br>
            <button type="button" onclick="generateResume()">Generate Resume</button>
          </form>
          <hr style="margin: 20px 0;">
          <h4>Or Upload Existing Resume</h4>
          <input type="file" id="resumeUpload" accept=".pdf,.doc,.docx" onchange="uploadResume()">
          <div id="uploadStatus"></div>
        </div>
        <div class="card" id="resumeOutput" style="display: none;">
          <h3>Generated Resume</h3>
          <div id="resumeContent"></div>
        </div>
      </div>
    </main>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-storage-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCgffF2_yiVYND2pl4j3-JJezYrI0Gzw7I",
    authDomain: "skill-bridge-92cff.firebaseapp.com",
    projectId: "skill-bridge-92cff",
    storageBucket: "skill-bridge-92cff.firebasestorage.app",
    messagingSenderId: "379886840265",
    appId: "1:379886840265:web:f73b1fc51080a2b7ace018",
    measurementId: "G-JKWNG1Y836"
  };

  firebase.initializeApp(firebaseConfig);
  window.auth = firebase.auth();
  window.db = firebase.firestore();
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(async (user) => {
    if (user) {
      const userDoc = await db.collection("users").doc(user.uid).get();
      if (userDoc.exists) {
        const userData = userDoc.data();
        document.querySelector('.profile').textContent = userData.name;
      }
    } else {
      window.location.href = 'login.html';
    }
  });
</script>
<script>
  const sidebar = document.getElementById("sidebar");
  function openSidebar(){ sidebar.classList.add("show"); }
  function closeSidebar(){ sidebar.classList.remove("show"); }
  function logout() {
    window.auth.signOut().then(() => {
      window.location.href = 'login.html';
    }).catch((error) => {
      console.error('Logout error:', error);
    });
  }
  window.openSidebar = openSidebar;
  window.closeSidebar = closeSidebar;
  window.logout = logout;

  function generateResume() {
    const name = document.getElementById("resumeName").value;
    const email = document.getElementById("resumeEmail").value;
    const phone = document.getElementById("resumePhone").value;
    const education = document.getElementById("resumeEducation").value;
    const skills = document.getElementById("resumeSkills").value;
    const experience = document.getElementById("resumeExperience").value;
    const projects = document.getElementById("resumeProjects").value;

    const content = document.getElementById("resumeContent");
    content.innerHTML = `
      <div style="text-align: center; margin-bottom: 20px;">
        <h2>${name}</h2>
        <p>${email} | ${phone}</p>
      </div>
      <div>
        <h4>Education</h4>
        <p>${education}</p>
      </div>
      <div>
        <h4>Skills</h4>
        <p>${skills}</p>
      </div>
      <div>
        <h4>Experience</h4>
        <p>${experience}</p>
      </div>
      <div>
        <h4>Projects</h4>
        <p>${projects}</p>
      </div>
    `;

    const output = document.getElementById("resumeOutput");
    output.style.display = "block";
  }

  function uploadResume() {
    const fileInput = document.getElementById("resumeUpload");
    const file = fileInput.files[0];
    const status = document.getElementById("uploadStatus");

    if (!file) {
      status.innerHTML = '<p style="color: red;">Please select a file first.</p>';
      return;
    }

    if (!file.type.includes('pdf') && !file.type.includes('word')) {
      status.innerHTML = '<p style="color: red;">Please upload a PDF or Word document.</p>';
      return;
    }

    status.innerHTML = '<p>Uploading...</p>';

    const storageRef = firebase.storage().ref();
    const resumeRef = storageRef.child(`resumes/${auth.currentUser.uid}/${file.name}`);

    resumeRef.put(file).then((snapshot) => {
      status.innerHTML = '<p style="color: green;">Resume uploaded successfully!</p>';
      // You can save the download URL to Firestore if needed
      snapshot.ref.getDownloadURL().then((downloadURL) => {
        console.log('File available at', downloadURL);
        // Save to user's profile in Firestore
        db.collection("users").doc(auth.currentUser.uid).update({
          resumeURL: downloadURL,
          resumeName: file.name
        });
      });
    }).catch((error) => {
      status.innerHTML = '<p style="color: red;">Upload failed. Please try again.</p>';
      console.error('Upload failed:', error);
    });
  }
</script>
</body>
</html>
